"use strict";(self.webpackChunkboxxerworld_customiser=self.webpackChunkboxxerworld_customiser||[]).push([[369],{9369:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var n=a(4875),i=a(9389),o=a(2791),l=a(7760),r=a(9355),d=a(846),s=a(9740),u=a(184);const c=e=>{let{node:t,texture:a,tasselsTexture:i,tassels:r,hex:s}=e;const[c,v]=(0,o.useState)(),p=(0,o.useRef)(null),m=(0,o.useRef)(null),[f,b]=(0,o.useState)(!1),[g,x]=(0,o.useState)(!1),h=(0,o.useMemo)((()=>Object.fromEntries(Object.entries(a).map((e=>{let[t,a]=e;return[t,a.clone()]})))),[a]),{customProduct:M,setSelectedNav:j,selectedNav:y,savedParts:w,navTabs:P,texts:S,flags:T,graphics:R,updateText:k,updateIsMinimizedCustomiserNav:U}=(0,n.b)(),O=(0,o.useMemo)((()=>S.find((e=>e.edit))),[S]),D=(0,o.useMemo)((()=>T.find((e=>e.edit))),[T]),N=(0,o.useMemo)((()=>R.find((e=>e.edit))),[R]),I=(0,o.useMemo)((()=>{var e,a;return null===M||void 0===M||null===(e=M.attributes)||void 0===e||null===(a=e.parts)||void 0===a?void 0:a.find((e=>{var a;return null===e||void 0===e||null===(a=e.modelParts)||void 0===a?void 0:a.data.find((e=>{var a,n;return(null===(a=e.attributes)||void 0===a?void 0:a.nodeId)===t.userData.name||(null===(n=e.attributes)||void 0===n?void 0:n.nodeId)===t.name}))}))}),[M,t]),C=(0,o.useMemo)((()=>{if(null!==I&&void 0!==I&&I.id)return(0,d.TR)({navTabs:P,value:I.id,key:"id"})}),[I,P]),E=(0,o.useMemo)((()=>{if(null!==I&&void 0!==I&&I.id)return(0,d.TR)({navTabs:P,value:"names",key:"type"})}),[P]);return(0,o.useEffect)((()=>{if(h&&m.current){let e={};for(const[t,a]of Object.entries(h)){a.wrapS=a.wrapT=l.RepeatWrapping;const n=(new l.Box3).setFromObject(m.current),i=new l.Vector3,o=n.getSize(i),r=o.x*o.y;a.repeat.set(5e-4*r,5e-4*r),e={...e,[t]:a}}v(e)}}),[h]),p.current&&(p.current.needsUpdate=!0),(0,u.jsx)(u.Fragment,{children:(0,u.jsx)("mesh",{name:t.name,geometry:t.geometry,ref:m,userData:{name:t.userData.name},onPointerDown:e=>{b(!0)},onPointerUp:()=>{x(!1),b(!1)},onPointerMove:e=>{f&&x(!0)},onClick:e=>{var a;if(b(!1),x(!1),g)return;if(null!==O&&void 0!==O&&O.key||null!==D&&void 0!==D&&D.key||null!==N&&void 0!==N&&N.key)return;const n=null===(a=e.intersections.find((e=>e.object.userData.text)))||void 0===a?void 0:a.object.userData.text;if(E&&void 0!==E.index&&n&&n.key)return U(!1),j(E.index),void k(n.key,{edit:!0});C&&void 0!==C.index&&e.intersections[0].object.name===t.name&&(e.stopPropagation(),U(!1),j(C.index))},children:r?(0,u.jsx)("meshStandardMaterial",{ref:p,...i,transparent:!0,bumpScale:.15,side:l.DoubleSide,metalness:-.5}):(0,u.jsx)("meshStandardMaterial",{side:l.DoubleSide,...c,displacementScale:null!==c&&void 0!==c&&c.displacementMap?-.001:void 0,ref:p})})})},v=e=>{let{node:t,nodeId:a}=e;const i=(0,n.b)((0,o.useCallback)((e=>e.texture(a)),[a])),r=(0,n.b)((0,o.useCallback)((e=>e.optional(a)),[a])),d=!!a.includes("default"),v=(0,s.m)({...i.materials}),p=(0,s.m)({alphaMap:"https://boxxer-api-dev.nyc3.cdn.digitaloceanspaces.com/tassels/tassels-opacity.jpg",bumpMap:"https://boxxer-api-dev.nyc3.cdn.digitaloceanspaces.com/tassels/tassels-bump.jpg",map:i.materials.map},(e=>{const[t,a,n]=e;a.wrapS=a.wrapT=l.RepeatWrapping,a.flipY=!1,a.repeat.set(1.5,1),a.needsUpdate=!0,t.wrapS=t.wrapT=l.RepeatWrapping,t.flipY=!1,t.repeat.set(1.5,1),t.needsUpdate=!0,n.wrapS=t.wrapT=l.RepeatWrapping,n.flipY=!1,n.repeat.set(1.5,1),n.needsUpdate=!0}));return r?null:(0,u.jsx)(c,{node:t,texture:v,tasselsTexture:p,tassels:d,hex:i.hex})},p=e=>{var t,a,n,i,l,d;let{model:s,addNodes:c}=e;const{nodes:p}=(0,r.L)(null===s||void 0===s||null===(t=s.attributes)||void 0===t||null===(a=t.model)||void 0===a||null===(n=a.data)||void 0===n||null===(i=n.attributes)||void 0===i?void 0:i.url);return(0,o.useEffect)((()=>(delete p.Scene,c(p),()=>{c(p,!0)})),[p]),(0,u.jsx)(u.Fragment,{children:null===s||void 0===s||null===(l=s.attributes)||void 0===l||null===(d=l.parts)||void 0===d?void 0:d.data.map((e=>{var t;return(0,u.jsx)(o.Fragment,{children:(null===e||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.nodeId)&&(0,u.jsx)(v,{node:p[e.attributes.nodeId],nodeId:e.attributes.nodeId},e.attributes.nodeId)},e.id)}))})};var m=a(1435);const f=e=>{var t,a,n,i,r,d,c,v,p,f;let{flag:b,graphic:g,position:x,orientation:h,scale:M=1}=e;const j=null!==b&&void 0!==b&&null!==(t=b.flag)&&void 0!==t&&null!==(a=t.attributes)&&void 0!==a&&null!==(n=a.image.data)&&void 0!==n&&null!==(i=n.attributes)&&void 0!==i&&i.url?[b.flag.attributes.image.data.attributes.url]:null!==g&&void 0!==g&&null!==(r=g.graphic)&&void 0!==r&&null!==(d=r.attributes)&&void 0!==d&&null!==(c=d.image)&&void 0!==c&&null!==(v=c.data)&&void 0!==v&&null!==(p=v.attributes)&&void 0!==p&&p.url?[g.graphic.attributes.image.data.attributes.url]:[],y=null===(f=b||g)||void 0===f?void 0:f.isVisible,w="undefined"===typeof y||y,[P]=(0,s.m)(j),S=(0,o.useMemo)((()=>{var e,t;return(null!==(e=P.source.data.width)&&void 0!==e?e:1)/(null!==(t=P.source.data.height)&&void 0!==t?t:1)}),[P]),T=(0,o.useMemo)((()=>{const e=(new l.Euler).fromArray(h),t=l.MathUtils.radToDeg(e.z),a=(null===b||void 0===b?void 0:b.decalRotation)||(null===g||void 0===g?void 0:g.decalRotation),n=t+(null!==a&&void 0!==a?a:0);return e.z=l.MathUtils.degToRad(n),e}),[null===b||void 0===b?void 0:b.decalRotation,null===g||void 0===g?void 0:g.decalRotation,h]),R=(0,o.useMemo)((()=>new l.Vector3(1*S*M,1*M,4)),[M]);return P?(0,u.jsx)(m._,{position:x,rotation:T,scale:R,children:(0,u.jsx)("meshPhongMaterial",{map:P,transparent:!0,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-20,needsUpdate:!0,opacity:w?1:0})}):null},b=e=>{var t,a,n,i,r,d,s,c,v,p;let{text:f={},position:b,orientation:g,scale:x=1}=e;const h=(0,o.useMemo)((()=>{var e;const t=(new l.Euler).fromArray(g),a=l.MathUtils.radToDeg(t.z)+(null!==(e=null===f||void 0===f?void 0:f.decalRotation)&&void 0!==e?e:0);return t.z=l.MathUtils.degToRad(a),t}),[null===f||void 0===f?void 0:f.decalRotation,g]),M=(null!==f&&void 0!==f&&null!==(t=f.material)&&void 0!==t&&null!==(a=t.attributes)&&void 0!==a&&null!==(n=a.images)&&void 0!==n&&n.length&&null!==(i=f.material.attributes.images[0])&&void 0!==i&&null!==(r=i.image.data)&&void 0!==r&&null!==(d=r.attributes)&&void 0!==d&&d.url&&f.material.attributes.images[0].image.data.attributes.url,f.normalMap instanceof l.Texture&&"Luxury"===(null===(s=f.selectedName)||void 0===s||null===(c=s.attributes)||void 0===c?void 0:c.name)?f.normalMap:null),j="2"===(null===(v=f.selectedName)||void 0===v?void 0:v.id),y=!!f.puffPrice,w=!!f.crystalPrice,P="undefined"===typeof f.isVisible||f.isVisible;let S=1;w?S=4:j&&!y?S=.5:j&&y&&(S=3);const T=(0,o.useMemo)((()=>new l.Vector3(3.2*x,.4*x,4)),[x]),R=(0,o.useRef)(null),[k,U]=(0,o.useState)(0);return(0,o.useEffect)((()=>{f.preview&&R.current&&f.preview instanceof l.Texture&&(f.preview.needsUpdate=!0,R.current.needsUpdate=!0)}),[f.preview]),(0,o.useEffect)((()=>{U((e=>e+1))}),[f.normalMap,f.puffPrice,f.crystalPrice,null===(p=f.selectedName)||void 0===p?void 0:p.id]),(0,u.jsx)(m._,{position:b,rotation:h,scale:T,children:(0,u.jsx)("meshStandardMaterial",{ref:R,transparent:!0,roughness:j&&!w?1:0,depthTest:!0,depthWrite:!1,map:f.preview instanceof l.Texture?f.preview:null,normalMap:M,normalScale:new l.Vector2(S,S),opacity:P?1:0})},k)},g=e=>{let{geom:t}=e;const a=(0,n.b)((e=>e.flags)),i=(0,n.b)((e=>e.texts)),o=(0,n.b)((e=>e.graphics));return(0,u.jsxs)("mesh",{geometry:t,renderOrder:1,children:[(0,u.jsx)("meshStandardMaterial",{transparent:!0,colorWrite:!1}),a.map((e=>{if(e.decalPosition&&e.decalOrientation)return(0,u.jsx)(f,{flag:e,position:e.decalPosition,orientation:e.decalOrientation,scale:e.decalScale},e.key)})),o.map((e=>{if(e.decalPosition&&e.decalOrientation)return(0,u.jsx)(f,{graphic:e,position:e.decalPosition,orientation:e.decalOrientation,scale:e.decalScale},e.key)})),i.map((e=>{if(e.decalPosition&&e.decalOrientation)return(0,u.jsx)(b,{text:e,position:e.decalPosition,orientation:e.decalOrientation,scale:e.decalScale},e.key)}))]})};var x=a(7133);const h=e=>{let{children:t}=e;const[a,i]=(0,o.useState)(),{customProduct:l}=(0,n.b)();return t({addNodes:function(e,t){if(t){const t={...a};for(const a in e)delete t[a];i({...t})}else i((t=>({...t,...e})))},geom:(0,o.useMemo)((()=>{const e=[];if(a)for(const[i,o]of Object.entries(a)){var t,n;const a=(null!==(t=null===l||void 0===l||null===(n=l.attributes)||void 0===n?void 0:n.parts)&&void 0!==t?t:[]).filter((e=>null===e||void 0===e?void 0:e.optional)).map((e=>{var t;return null===e||void 0===e||null===(t=e.modelParts)||void 0===t?void 0:t.data})).flat().find((e=>{var t;return(null===e||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.nodeId)===i}));o.isMesh&&!a&&e.push(o.geometry.clone())}return e.length?x.qf(e):null}),[a])})},M=e=>e.selectedModels,j=(0,o.forwardRef)(((e,t)=>{let{onPointerDown:a,onPointerUp:r,onPointerMove:d,onClick:s}=e;const c=(0,n.b)(M),{remountTrigger:v}=(0,n.b)(),m=(0,i.H)((e=>e.modelRotation)),f=(0,i.H)((e=>e.addingToCart));return(0,o.useEffect)((()=>{f&&"function"!==typeof t&&null!==t&&void 0!==t&&t.current&&t.current.rotateY(l.MathUtils.degToRad(m))}),[f,m]),(0,u.jsx)("group",{name:"meshGroup",ref:t,onPointerDown:a,onPointerUp:r,onPointerMove:d,onClick:s,dispose:null,children:(0,u.jsx)(h,{children:e=>{let{addNodes:t,geom:a}=e;return(0,u.jsxs)(u.Fragment,{children:[c.map((e=>{var a;return(0,u.jsx)(p,{model:e.model,addNodes:t},null===(a=e.model)||void 0===a?void 0:a.id)})),a&&(0,u.jsx)(g,{geom:a})]})}},v)})}));j.displayName="Scene";const y=j}}]);
//# sourceMappingURL=369.e21b84d6.chunk.js.map