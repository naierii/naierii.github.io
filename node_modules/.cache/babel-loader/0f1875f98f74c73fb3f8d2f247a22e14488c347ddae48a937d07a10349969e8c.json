{"ast":null,"code":"import{OrbitControls}from'@react-three/drei';import{Canvas}from'@react-three/fiber';import cn from'classnames';import{lazy,useCallback,useEffect,useRef,useState}from'react';import{useCreateCustomDesignMutation,useUploadMultipleFilesMutation}from'@graphql/generated/graphql';import{graphQLClient}from'@graphql/graphql-client';import{addToCart}from'@lib/shopify';import{useCustomiserStore}from'@store/customiser';import{useDesignStore}from'@store/design';import{useMutation}from'@tanstack/react-query';import{Euler,Vector3}from'three';import Lights from'../Lights';import Loadable from'../Loadable';import MouseHelper from'../MouseHelper';import styles from'./CustomiserCanvas.module.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";const Scene=Loadable(/*#__PURE__*/lazy(()=>import('@components/three/Scene')));const getCustomDesignData=(state,files)=>{var _state$customProduct,_state$sizing,_state$sizing$variati,_state$sizing2,_state$sizing3,_state$sizing3$height,_state$sizing3$height2,_state$sizing4,_state$sizing4$height,_state$sizing5,_state$sizing5$weight,_state$sizing6,_state$sizing6$weight;return{customProduct:(_state$customProduct=state.customProduct)===null||_state$customProduct===void 0?void 0:_state$customProduct.id,parts:state.savedParts.map(p=>{var _p$part$areaSize,_p$part$areaSize$data;return{name:p.part.name,areaSize:(_p$part$areaSize=p.part.areaSize)===null||_p$part$areaSize===void 0?void 0:(_p$part$areaSize$data=_p$part$areaSize.data)===null||_p$part$areaSize$data===void 0?void 0:_p$part$areaSize$data.id,material:p.material.id};}),texts:state.texts.map(t=>{var _t$basePrice,_t$letterPrice,_t$outlinePrice,_t$puffPrice,_t$crystalPrice;return{text:t.text,decalPosition:t.decalPosition,decalOrientation:t.decalOrientation,decalRotation:t.decalRotation,decalScale:t.decalScale,basePriceVariantId:(_t$basePrice=t.basePrice)===null||_t$basePrice===void 0?void 0:_t$basePrice.shopifyVariantId,letterPriceVariantId:(_t$letterPrice=t.letterPrice)===null||_t$letterPrice===void 0?void 0:_t$letterPrice.shopifyVariantId,outlinePriceVariantId:(_t$outlinePrice=t.outlinePrice)===null||_t$outlinePrice===void 0?void 0:_t$outlinePrice.shopifyVariantId,puffPriceVariantId:(_t$puffPrice=t.puffPrice)===null||_t$puffPrice===void 0?void 0:_t$puffPrice.shopifyVariantId,crystalPriceVariantId:(_t$crystalPrice=t.crystalPrice)===null||_t$crystalPrice===void 0?void 0:_t$crystalPrice.shopifyVariantId};}),flags:state.flags.map(f=>{var _f$flag,_f$basePrice;return{flag:(_f$flag=f.flag)===null||_f$flag===void 0?void 0:_f$flag.id,decalPosition:f.decalPosition,decalOrientation:f.decalOrientation,decalRotation:f.decalRotation,decalScale:f.decalScale,size:f.size,shopifyVariantId:(_f$basePrice=f.basePrice)===null||_f$basePrice===void 0?void 0:_f$basePrice.shopifyVariantId};}),graphics:state.graphics.map(g=>{var _g$graphic,_g$basePrice;return{graphic:(_g$graphic=g.graphic)===null||_g$graphic===void 0?void 0:_g$graphic.id,decalPosition:g.decalPosition,decalOrientation:g.decalOrientation,decalRotation:g.decalRotation,decalScale:g.decalScale,size:g.size,shopifyVariantId:(_g$basePrice=g.basePrice)===null||_g$basePrice===void 0?void 0:_g$basePrice.shopifyVariantId};}),images:files,sizing:{shopifyVariantId:(_state$sizing=state.sizing)===null||_state$sizing===void 0?void 0:(_state$sizing$variati=_state$sizing.variation)===null||_state$sizing$variati===void 0?void 0:_state$sizing$variati.id,size:(_state$sizing2=state.sizing)===null||_state$sizing2===void 0?void 0:_state$sizing2.size,height:(_state$sizing3=state.sizing)===null||_state$sizing3===void 0?void 0:(_state$sizing3$height=_state$sizing3.height)===null||_state$sizing3$height===void 0?void 0:(_state$sizing3$height2=_state$sizing3$height.value)===null||_state$sizing3$height2===void 0?void 0:_state$sizing3$height2.toString(),heightUnit:(_state$sizing4=state.sizing)===null||_state$sizing4===void 0?void 0:(_state$sizing4$height=_state$sizing4.height)===null||_state$sizing4$height===void 0?void 0:_state$sizing4$height.unit,weight:(_state$sizing5=state.sizing)===null||_state$sizing5===void 0?void 0:(_state$sizing5$weight=_state$sizing5.weight)===null||_state$sizing5$weight===void 0?void 0:_state$sizing5$weight.value,weightUnit:(_state$sizing6=state.sizing)===null||_state$sizing6===void 0?void 0:(_state$sizing6$weight=_state$sizing6.weight)===null||_state$sizing6$weight===void 0?void 0:_state$sizing6$weight.unit}};};const getCartVariations=customDesignEntity=>{var _customDesign$parts,_customDesign$flags,_customDesign$graphic,_customDesign$texts,_customDesign$sizing;const customDesignId=customDesignEntity===null||customDesignEntity===void 0?void 0:customDesignEntity.id;const customDesign=customDesignEntity===null||customDesignEntity===void 0?void 0:customDesignEntity.attributes;if(!customDesign||!customDesignId){return[];}// eslint-disable-next-line @typescript-eslint/no-explicit-any\nconst items=[];const id=id=>id===null||id===void 0?void 0:id.replace('gid://shopify/ProductVariant/','');const getItem=id=>items.find(i=>i.id===id);const addOrUpdate=function(variantId){let addQty=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;const checkItem=getItem(variantId);if(checkItem){const newQuantity=checkItem.quantity+addQty;checkItem.quantity=newQuantity;checkItem.properties._customDesignQuantity=newQuantity;}else{items.push({id:variantId,quantity:addQty,properties:{_customDesignAddon:customDesignId,_customDesignQuantity:addQty}});}};if((_customDesign$parts=customDesign.parts)!==null&&_customDesign$parts!==void 0&&_customDesign$parts.length){customDesign.parts.forEach(p=>{const variantId=id(p===null||p===void 0?void 0:p.shopifyVariantId);if(variantId)addOrUpdate(variantId);});}if((_customDesign$flags=customDesign.flags)!==null&&_customDesign$flags!==void 0&&_customDesign$flags.length){customDesign.flags.forEach(p=>{const variantId=id(p===null||p===void 0?void 0:p.shopifyVariantId);if(variantId)addOrUpdate(variantId);});}if((_customDesign$graphic=customDesign.graphics)!==null&&_customDesign$graphic!==void 0&&_customDesign$graphic.length){customDesign.graphics.forEach(p=>{const variantId=id(p===null||p===void 0?void 0:p.shopifyVariantId);if(variantId)addOrUpdate(variantId);});}if((_customDesign$texts=customDesign.texts)!==null&&_customDesign$texts!==void 0&&_customDesign$texts.length){customDesign.texts.forEach(t=>{var _t$text;const basePrice=id(t===null||t===void 0?void 0:t.basePriceVariantId);if(basePrice)addOrUpdate(basePrice);const letterPrice=id(t===null||t===void 0?void 0:t.letterPriceVariantId);if(letterPrice)addOrUpdate(letterPrice,t===null||t===void 0?void 0:(_t$text=t.text)===null||_t$text===void 0?void 0:_t$text.length);const outlinePrice=id(t===null||t===void 0?void 0:t.outlinePriceVariantId);if(outlinePrice)addOrUpdate(outlinePrice);const puffPrice=id(t===null||t===void 0?void 0:t.puffPriceVariantId);if(puffPrice)addOrUpdate(puffPrice);const crystalPrice=id(t===null||t===void 0?void 0:t.crystalPriceVariantId);if(crystalPrice)addOrUpdate(crystalPrice);});}if((_customDesign$sizing=customDesign.sizing)!==null&&_customDesign$sizing!==void 0&&_customDesign$sizing.shopifyVariantId){items.push({id:id(customDesign.sizing.shopifyVariantId),quantity:1,properties:{_customDesign:customDesignId}});}return items;};export const cameraDefault=[0,2.1970893240496195e-15,15.31024512625285];const CustomiserCanvas=_ref=>{let{className,style,onCameraRef}=_ref;const cameraRef=useRef(null);const canvasRef=useRef(null);const images=useRef([]);const positionRef=useRef(new Vector3());const orientationRef=useRef(new Euler());const groupRef=useRef(null);const editFlag=useCustomiserStore(state=>state.flags.find(f=>f.edit));const editText=useCustomiserStore(state=>state.texts.find(f=>f.edit));const editGraphic=useCustomiserStore(state=>state.graphics.find(f=>f.edit));const updateGraphic=useCustomiserStore(state=>state.updateGraphic);const updateFlag=useCustomiserStore(state=>state.updateFlag);const updateText=useCustomiserStore(state=>state.updateText);const setCanvasSize=useCustomiserStore(state=>state.setCanvasSize);const resetCamera=useDesignStore(state=>state.resetCamera);const addingToCart=useDesignStore(state=>state.addingToCart);const modelRotation=useDesignStore(state=>state.modelRotation);const setAddingToCart=useDesignStore(state=>state.setAddingToCart);const setModelRotation=useDesignStore(state=>state.setModelRotation);const reset=useCustomiserStore(state=>state.reset);const rootClassName=cn(styles.root,className);const mouseHelperRef=useRef(null);const state=useCustomiserStore(state=>state);const[isPointerDown,setIsPointerDown]=useState(false);const[isPointerMoved,setIsPointerMoved]=useState(false);const setPosition=useCallback(event=>{var _event$face;const p=event.point;const n=event===null||event===void 0?void 0:(_event$face=event.face)===null||_event$face===void 0?void 0:_event$face.normal.clone();if(mouseHelperRef.current&&n&&groupRef.current){n.transformDirection(groupRef.current.matrixWorld);n.multiplyScalar(10);n.add(p);mouseHelperRef.current.position.copy(p);mouseHelperRef.current.lookAt(n);}},[mouseHelperRef]);const onClick=useCallback(event=>{setIsPointerDown(false);setIsPointerMoved(false);if(!isPointerDown||isPointerMoved){return;}if(editFlag!==null&&editFlag!==void 0&&editFlag.key){event.stopPropagation();updateFlag(editFlag.key,{decalFreeze:true});setPosition(event);if(mouseHelperRef.current&&positionRef.current&&orientationRef.current){positionRef.current.copy(event.point);orientationRef.current.copy(mouseHelperRef.current.rotation);updateFlag(editFlag.key,{decalPosition:positionRef.current.clone().toArray(),decalOrientation:orientationRef.current.clone().toArray()});}}if(editGraphic!==null&&editGraphic!==void 0&&editGraphic.key){event.stopPropagation();updateGraphic(editGraphic.key,{decalFreeze:true});setPosition(event);if(mouseHelperRef.current&&positionRef.current&&orientationRef.current){positionRef.current.copy(event.point);orientationRef.current.copy(mouseHelperRef.current.rotation);updateGraphic(editGraphic.key,{decalPosition:positionRef.current.clone().toArray(),decalOrientation:orientationRef.current.clone().toArray()});}}if(editText!==null&&editText!==void 0&&editText.key){event.stopPropagation();updateText(editText.key,{decalFreeze:true});setPosition(event);if(mouseHelperRef.current&&positionRef.current&&orientationRef.current){positionRef.current.copy(event.point);orientationRef.current.copy(mouseHelperRef.current.rotation);updateText(editText.key,{decalPosition:positionRef.current.clone().toArray(),decalOrientation:orientationRef.current.clone().toArray()});}}},[editFlag,editGraphic,editText,isPointerDown,isPointerMoved]);const onPointerDown=useCallback(()=>{setIsPointerDown(true);},[]);const onPointerMove=useCallback(e=>{if(isPointerDown){setIsPointerMoved(true);}},[isPointerDown]);const shopifyAddToCart=useMutation({mutationFn:addToCart,onSuccess:()=>{window.location.href=window.Shopify.routes.root+'cart';reset();}});const{mutate}=useCreateCustomDesignMutation(graphQLClient,{onSuccess(data){var _data$createCustomDes;if((_data$createCustomDes=data.createCustomDesign)!==null&&_data$createCustomDes!==void 0&&_data$createCustomDes.data){const items=getCartVariations(data.createCustomDesign.data);shopifyAddToCart.mutate({items:items});}}});const{mutateAsync}=useUploadMultipleFilesMutation(graphQLClient,{onSuccess(data){const fileIDs=data.multipleUpload.map(f=>{var _f$data;return f===null||f===void 0?void 0:(_f$data=f.data)===null||_f$data===void 0?void 0:_f$data.id;});mutate({data:getCustomDesignData(state,fileIDs)});}});useEffect(()=>{if(addingToCart&&modelRotation<360){setTimeout(()=>{var _canvasRef$current;canvasRef===null||canvasRef===void 0?void 0:(_canvasRef$current=canvasRef.current)===null||_canvasRef$current===void 0?void 0:_canvasRef$current.toBlob(blob=>{if(blob){const file=new File([blob],'fileName.png',{type:'image/png'});images.current.push(file);setModelRotation(modelRotation+90);}},'image/png');},50);}else if(addingToCart){const upload=async()=>{await mutateAsync({files:images.current});};upload();}},[modelRotation,addingToCart,images]);useEffect(()=>{const camera=cameraRef.current;if(!camera){return;}if(resetCamera){camera.position.set(cameraDefault[0],cameraDefault[1],cameraDefault[2]);setAddingToCart();}},[resetCamera]);useEffect(()=>{if(onCameraRef&&cameraRef.current){onCameraRef(cameraRef.current);}},[onCameraRef]);const isEditing=editFlag||editGraphic||editText;return/*#__PURE__*/_jsx(\"div\",{className:rootClassName,style:style,children:/*#__PURE__*/_jsxs(Canvas,{linear:true,flat:true,camera:{position:cameraDefault,fov:45},dpr:window.devicePixelRatio,gl:{preserveDrawingBuffer:true},ref:canvasRef,onCreated:state=>{setCanvasSize(state.size.width,state.size.height);cameraRef.current=state.camera;},frameloop:\"demand\",children:[/*#__PURE__*/_jsx(Scene,{onClick:onClick,onPointerDown:onPointerDown,onPointerMove:onPointerMove,ref:groupRef}),/*#__PURE__*/_jsx(Lights,{}),isEditing&&/*#__PURE__*/_jsx(MouseHelper,{ref:mouseHelperRef}),/*#__PURE__*/_jsx(OrbitControls,{enableZoom:true,maxDistance:30,minDistance:10,minPolarAngle:Math.PI/3,maxPolarAngle:Math.PI/1.9})]})});};export default CustomiserCanvas;","map":{"version":3,"names":["OrbitControls","Canvas","cn","lazy","useCallback","useEffect","useRef","useState","useCreateCustomDesignMutation","useUploadMultipleFilesMutation","graphQLClient","addToCart","useCustomiserStore","useDesignStore","useMutation","Euler","Vector3","Lights","Loadable","MouseHelper","styles","jsx","_jsx","jsxs","_jsxs","Scene","getCustomDesignData","state","files","_state$customProduct","_state$sizing","_state$sizing$variati","_state$sizing2","_state$sizing3","_state$sizing3$height","_state$sizing3$height2","_state$sizing4","_state$sizing4$height","_state$sizing5","_state$sizing5$weight","_state$sizing6","_state$sizing6$weight","customProduct","id","parts","savedParts","map","p","_p$part$areaSize","_p$part$areaSize$data","name","part","areaSize","data","material","texts","t","_t$basePrice","_t$letterPrice","_t$outlinePrice","_t$puffPrice","_t$crystalPrice","text","decalPosition","decalOrientation","decalRotation","decalScale","basePriceVariantId","basePrice","shopifyVariantId","letterPriceVariantId","letterPrice","outlinePriceVariantId","outlinePrice","puffPriceVariantId","puffPrice","crystalPriceVariantId","crystalPrice","flags","f","_f$flag","_f$basePrice","flag","size","graphics","g","_g$graphic","_g$basePrice","graphic","images","sizing","variation","height","value","toString","heightUnit","unit","weight","weightUnit","getCartVariations","customDesignEntity","_customDesign$parts","_customDesign$flags","_customDesign$graphic","_customDesign$texts","_customDesign$sizing","customDesignId","customDesign","attributes","items","replace","getItem","find","i","addOrUpdate","variantId","addQty","arguments","length","undefined","checkItem","newQuantity","quantity","properties","_customDesignQuantity","push","_customDesignAddon","forEach","_t$text","_customDesign","cameraDefault","CustomiserCanvas","_ref","className","style","onCameraRef","cameraRef","canvasRef","positionRef","orientationRef","groupRef","editFlag","edit","editText","editGraphic","updateGraphic","updateFlag","updateText","setCanvasSize","resetCamera","addingToCart","modelRotation","setAddingToCart","setModelRotation","reset","rootClassName","root","mouseHelperRef","isPointerDown","setIsPointerDown","isPointerMoved","setIsPointerMoved","setPosition","event","_event$face","point","n","face","normal","clone","current","transformDirection","matrixWorld","multiplyScalar","add","position","copy","lookAt","onClick","key","stopPropagation","decalFreeze","rotation","toArray","onPointerDown","onPointerMove","e","shopifyAddToCart","mutationFn","onSuccess","window","location","href","Shopify","routes","mutate","_data$createCustomDes","createCustomDesign","mutateAsync","fileIDs","multipleUpload","_f$data","setTimeout","_canvasRef$current","toBlob","blob","file","File","type","upload","camera","set","isEditing","children","linear","flat","fov","dpr","devicePixelRatio","gl","preserveDrawingBuffer","ref","onCreated","width","frameloop","enableZoom","maxDistance","minDistance","minPolarAngle","Math","PI","maxPolarAngle"],"sources":["C:/Users/Reian/Desktop/Work/Freelance/Boxxer World/boxxerworld-shopify-frontend/customiser/src/components/three/CustomiserCanvas/CustomiserCanvas.tsx"],"sourcesContent":["import { OrbitControls } from '@react-three/drei';\r\nimport { Canvas, ThreeEvent } from '@react-three/fiber';\r\nimport cn from 'classnames';\r\nimport { CSSProperties, lazy, useCallback, useEffect, useRef, useState } from 'react';\r\n\r\nimport {\r\n  CustomDesignEntity,\r\n  CustomDesignInput,\r\n  Maybe,\r\n  useCreateCustomDesignMutation,\r\n  useUploadMultipleFilesMutation,\r\n} from '@graphql/generated/graphql';\r\nimport { graphQLClient } from '@graphql/graphql-client';\r\nimport { addToCart } from '@lib/shopify';\r\nimport { CustomiserState, useCustomiserStore } from '@store/customiser';\r\nimport { useDesignStore } from '@store/design';\r\nimport { useMutation } from '@tanstack/react-query';\r\nimport { Camera, Euler, Group, Mesh, Vector3 } from 'three';\r\n\r\nimport Lights from '../Lights';\r\nimport Loadable from '../Loadable';\r\nimport MouseHelper from '../MouseHelper';\r\nimport { SceneProps } from '../Scene/Scene';\r\nimport styles from './CustomiserCanvas.module.scss';\r\n\r\nimport ThreeScene from '@components/three/Scene';\r\n\r\nconst Scene = Loadable(lazy(() => import('@components/three/Scene'))) as typeof ThreeScene;\r\n\r\nexport interface CustomiserCanvasProps {\r\n  className?: string;\r\n  style?: CSSProperties;\r\n  onCameraRef: (ref: Camera | null) => void;\r\n}\r\n\r\nconst getCustomDesignData = (state: CustomiserState, files: string[]): CustomDesignInput => ({\r\n  customProduct: state.customProduct?.id,\r\n  parts: state.savedParts.map((p) => ({\r\n    name: p.part.name,\r\n    areaSize: p.part.areaSize?.data?.id,\r\n    material: p.material.id,\r\n  })),\r\n  texts: state.texts.map((t) => ({\r\n    text: t.text,\r\n    decalPosition: t.decalPosition,\r\n    decalOrientation: t.decalOrientation,\r\n    decalRotation: t.decalRotation,\r\n    decalScale: t.decalScale,\r\n    basePriceVariantId: t.basePrice?.shopifyVariantId,\r\n    letterPriceVariantId: t.letterPrice?.shopifyVariantId,\r\n    outlinePriceVariantId: t.outlinePrice?.shopifyVariantId,\r\n    puffPriceVariantId: t.puffPrice?.shopifyVariantId,\r\n    crystalPriceVariantId: t.crystalPrice?.shopifyVariantId,\r\n  })),\r\n  flags: state.flags.map((f) => ({\r\n    flag: f.flag?.id,\r\n    decalPosition: f.decalPosition,\r\n    decalOrientation: f.decalOrientation,\r\n    decalRotation: f.decalRotation,\r\n    decalScale: f.decalScale,\r\n    size: f.size,\r\n    shopifyVariantId: f.basePrice?.shopifyVariantId,\r\n  })),\r\n  graphics: state.graphics.map((g) => ({\r\n    graphic: g.graphic?.id,\r\n    decalPosition: g.decalPosition,\r\n    decalOrientation: g.decalOrientation,\r\n    decalRotation: g.decalRotation,\r\n    decalScale: g.decalScale,\r\n    size: g.size,\r\n    shopifyVariantId: g.basePrice?.shopifyVariantId,\r\n  })),\r\n  images: files,\r\n  sizing: {\r\n    shopifyVariantId: state.sizing?.variation?.id,\r\n    size: state.sizing?.size,\r\n    height: state.sizing?.height?.value?.toString(),\r\n    heightUnit: state.sizing?.height?.unit,\r\n    weight: state.sizing?.weight?.value,\r\n    weightUnit: state.sizing?.weight?.unit,\r\n  },\r\n});\r\n\r\nconst getCartVariations = (customDesignEntity?: CustomDesignEntity) => {\r\n  const customDesignId = customDesignEntity?.id;\r\n  const customDesign = customDesignEntity?.attributes;\r\n\r\n  if (!customDesign || !customDesignId) {\r\n    return [];\r\n  }\r\n\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  const items: Array<{ id?: string; quantity: number; properties: any }> = [];\r\n  const id = (id?: Maybe<string>) => id?.replace('gid://shopify/ProductVariant/', '');\r\n  const getItem = (id?: string) => items.find((i) => i.id === id);\r\n  const addOrUpdate = (variantId: string, addQty = 1) => {\r\n    const checkItem = getItem(variantId);\r\n    if (checkItem) {\r\n      const newQuantity = checkItem.quantity + addQty;\r\n      checkItem.quantity = newQuantity;\r\n      checkItem.properties._customDesignQuantity = newQuantity;\r\n    } else {\r\n      items.push({\r\n        id: variantId,\r\n        quantity: addQty,\r\n        properties: {\r\n          _customDesignAddon: customDesignId,\r\n          _customDesignQuantity: addQty,\r\n        },\r\n      });\r\n    }\r\n  };\r\n\r\n  if (customDesign.parts?.length) {\r\n    customDesign.parts.forEach((p) => {\r\n      const variantId = id(p?.shopifyVariantId);\r\n      if (variantId) addOrUpdate(variantId);\r\n    });\r\n  }\r\n\r\n  if (customDesign.flags?.length) {\r\n    customDesign.flags.forEach((p) => {\r\n      const variantId = id(p?.shopifyVariantId);\r\n      if (variantId) addOrUpdate(variantId);\r\n    });\r\n  }\r\n\r\n  if (customDesign.graphics?.length) {\r\n    customDesign.graphics.forEach((p) => {\r\n      const variantId = id(p?.shopifyVariantId);\r\n      if (variantId) addOrUpdate(variantId);\r\n    });\r\n  }\r\n\r\n  if (customDesign.texts?.length) {\r\n    customDesign.texts.forEach((t) => {\r\n      const basePrice = id(t?.basePriceVariantId);\r\n      if (basePrice) addOrUpdate(basePrice);\r\n      const letterPrice = id(t?.letterPriceVariantId);\r\n      if (letterPrice) addOrUpdate(letterPrice, t?.text?.length);\r\n      const outlinePrice = id(t?.outlinePriceVariantId);\r\n      if (outlinePrice) addOrUpdate(outlinePrice);\r\n      const puffPrice = id(t?.puffPriceVariantId);\r\n      if (puffPrice) addOrUpdate(puffPrice);\r\n      const crystalPrice = id(t?.crystalPriceVariantId);\r\n      if (crystalPrice) addOrUpdate(crystalPrice);\r\n    });\r\n  }\r\n\r\n  if (customDesign.sizing?.shopifyVariantId) {\r\n    items.push({\r\n      id: id(customDesign.sizing.shopifyVariantId),\r\n      quantity: 1,\r\n      properties: {\r\n        _customDesign: customDesignId,\r\n      },\r\n    });\r\n  }\r\n\r\n  return items;\r\n};\r\n\r\nexport const cameraDefault: [x: number, y: number, z: number] = [\r\n  0, 2.1970893240496195e-15, 15.31024512625285,\r\n];\r\n\r\nconst CustomiserCanvas = ({\r\n  className,\r\n  style,\r\n  onCameraRef,\r\n}: CustomiserCanvasProps): JSX.Element => {\r\n  const cameraRef = useRef<Camera | null>(null);\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const images = useRef<File[]>([]);\r\n  const positionRef = useRef<Vector3>(new Vector3());\r\n  const orientationRef = useRef<Euler>(new Euler());\r\n  const groupRef = useRef<Group>(null);\r\n  const editFlag = useCustomiserStore((state) => state.flags.find((f) => f.edit));\r\n  const editText = useCustomiserStore((state) => state.texts.find((f) => f.edit));\r\n  const editGraphic = useCustomiserStore((state) => state.graphics.find((f) => f.edit));\r\n  const updateGraphic = useCustomiserStore((state) => state.updateGraphic);\r\n  const updateFlag = useCustomiserStore((state) => state.updateFlag);\r\n  const updateText = useCustomiserStore((state) => state.updateText);\r\n  const setCanvasSize = useCustomiserStore((state) => state.setCanvasSize);\r\n  const resetCamera = useDesignStore((state) => state.resetCamera);\r\n  const addingToCart = useDesignStore((state) => state.addingToCart);\r\n  const modelRotation = useDesignStore((state) => state.modelRotation);\r\n  const setAddingToCart = useDesignStore((state) => state.setAddingToCart);\r\n  const setModelRotation = useDesignStore((state) => state.setModelRotation);\r\n  const reset = useCustomiserStore((state) => state.reset);\r\n  const rootClassName = cn(styles.root, className);\r\n  const mouseHelperRef = useRef<Mesh>(null);\r\n  const state = useCustomiserStore((state) => state);\r\n\r\n  const [isPointerDown, setIsPointerDown] = useState(false);\r\n  const [isPointerMoved, setIsPointerMoved] = useState(false);\r\n\r\n  const setPosition = useCallback(\r\n    (event: ThreeEvent<MouseEvent>) => {\r\n      const p = event.point;\r\n      const n = event?.face?.normal.clone();\r\n      if (mouseHelperRef.current && n && groupRef.current) {\r\n        n.transformDirection(groupRef.current.matrixWorld);\r\n        n.multiplyScalar(10);\r\n        n.add(p);\r\n        mouseHelperRef.current.position.copy(p);\r\n        mouseHelperRef.current.lookAt(n);\r\n      }\r\n    },\r\n    [mouseHelperRef],\r\n  );\r\n\r\n  const onClick = useCallback<Required<SceneProps>['onClick']>(\r\n    (event) => {\r\n      setIsPointerDown(false);\r\n      setIsPointerMoved(false);\r\n\r\n      if (!isPointerDown || isPointerMoved) {\r\n        return;\r\n      }\r\n\r\n      if (editFlag?.key) {\r\n        event.stopPropagation();\r\n\r\n        updateFlag(editFlag.key, { decalFreeze: true });\r\n        setPosition(event);\r\n        if (mouseHelperRef.current && positionRef.current && orientationRef.current) {\r\n          positionRef.current.copy(event.point);\r\n          orientationRef.current.copy(mouseHelperRef.current.rotation);\r\n          updateFlag(editFlag.key, {\r\n            decalPosition: positionRef.current.clone().toArray(),\r\n            decalOrientation: orientationRef.current.clone().toArray(),\r\n          });\r\n        }\r\n      }\r\n\r\n      if (editGraphic?.key) {\r\n        event.stopPropagation();\r\n\r\n        updateGraphic(editGraphic.key, { decalFreeze: true });\r\n        setPosition(event);\r\n        if (mouseHelperRef.current && positionRef.current && orientationRef.current) {\r\n          positionRef.current.copy(event.point);\r\n          orientationRef.current.copy(mouseHelperRef.current.rotation);\r\n          updateGraphic(editGraphic.key, {\r\n            decalPosition: positionRef.current.clone().toArray(),\r\n            decalOrientation: orientationRef.current.clone().toArray(),\r\n          });\r\n        }\r\n      }\r\n\r\n      if (editText?.key) {\r\n        event.stopPropagation();\r\n        updateText(editText.key, { decalFreeze: true });\r\n        setPosition(event);\r\n        if (mouseHelperRef.current && positionRef.current && orientationRef.current) {\r\n          positionRef.current.copy(event.point);\r\n          orientationRef.current.copy(mouseHelperRef.current.rotation);\r\n          updateText(editText.key, {\r\n            decalPosition: positionRef.current.clone().toArray(),\r\n            decalOrientation: orientationRef.current.clone().toArray(),\r\n          });\r\n        }\r\n      }\r\n    },\r\n    [editFlag, editGraphic, editText, isPointerDown, isPointerMoved],\r\n  );\r\n\r\n  const onPointerDown = useCallback<Required<SceneProps>['onPointerDown']>(() => {\r\n    setIsPointerDown(true);\r\n  }, []);\r\n\r\n  const onPointerMove = useCallback<Required<SceneProps>['onPointerMove']>(\r\n    (e) => {\r\n      if (isPointerDown) {\r\n        setIsPointerMoved(true);\r\n      }\r\n    },\r\n    [isPointerDown],\r\n  );\r\n\r\n  const shopifyAddToCart = useMutation({\r\n    mutationFn: addToCart,\r\n    onSuccess: () => {\r\n      window.location.href = window.Shopify.routes.root + 'cart';\r\n      reset();\r\n    },\r\n  });\r\n\r\n  const { mutate } = useCreateCustomDesignMutation(graphQLClient, {\r\n    onSuccess(data) {\r\n      if (data.createCustomDesign?.data) {\r\n        const items = getCartVariations(data.createCustomDesign.data);\r\n        shopifyAddToCart.mutate({ items: items });\r\n      }\r\n    },\r\n  });\r\n\r\n  const { mutateAsync } = useUploadMultipleFilesMutation(graphQLClient, {\r\n    onSuccess(data) {\r\n      const fileIDs = data.multipleUpload.map((f) => f?.data?.id) as string[];\r\n      mutate({ data: getCustomDesignData(state, fileIDs) });\r\n    },\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (addingToCart && modelRotation < 360) {\r\n      setTimeout(() => {\r\n        canvasRef?.current?.toBlob((blob) => {\r\n          if (blob) {\r\n            const file = new File([blob], 'fileName.png', { type: 'image/png' });\r\n            images.current.push(file);\r\n            setModelRotation(modelRotation + 90);\r\n          }\r\n        }, 'image/png');\r\n      }, 50);\r\n    } else if (addingToCart) {\r\n      const upload = async () => {\r\n        await mutateAsync({ files: images.current });\r\n      };\r\n      upload();\r\n    }\r\n  }, [modelRotation, addingToCart, images]);\r\n\r\n  useEffect(() => {\r\n    const camera = cameraRef.current;\r\n    if (!camera) {\r\n      return;\r\n    }\r\n    if (resetCamera) {\r\n      camera.position.set(cameraDefault[0], cameraDefault[1], cameraDefault[2]);\r\n      setAddingToCart();\r\n    }\r\n  }, [resetCamera]);\r\n\r\n  useEffect(() => {\r\n    if (onCameraRef && cameraRef.current) {\r\n      onCameraRef(cameraRef.current);\r\n    }\r\n  }, [onCameraRef]);\r\n\r\n  const isEditing = editFlag || editGraphic || editText;\r\n\r\n  return (\r\n    <div className={rootClassName} style={style}>\r\n      <Canvas\r\n        linear\r\n        flat\r\n        camera={{\r\n          position: cameraDefault,\r\n          fov: 45,\r\n        }}\r\n        dpr={window.devicePixelRatio}\r\n        gl={{ preserveDrawingBuffer: true }}\r\n        ref={canvasRef}\r\n        onCreated={(state) => {\r\n          setCanvasSize(state.size.width, state.size.height);\r\n          cameraRef.current = state.camera;\r\n        }}\r\n        frameloop='demand'\r\n      >\r\n        <Scene\r\n          onClick={onClick}\r\n          onPointerDown={onPointerDown}\r\n          onPointerMove={onPointerMove}\r\n          ref={groupRef}\r\n        />\r\n        <Lights />\r\n        {isEditing && <MouseHelper ref={mouseHelperRef} />}\r\n        <OrbitControls\r\n          enableZoom={true}\r\n          maxDistance={30}\r\n          minDistance={10}\r\n          minPolarAngle={Math.PI / 3}\r\n          maxPolarAngle={Math.PI / 1.9}\r\n        />\r\n      </Canvas>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CustomiserCanvas;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}