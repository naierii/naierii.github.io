"use strict";(self.webpackChunkboxxerworld_customiser=self.webpackChunkboxxerworld_customiser||[]).push([[369],{9369:(e,t,n)=>{n.r(t),n.d(t,{default:()=>j});var a=n(4875),o=n(9389),i=n(2791),r=n(7760),l=n(9355),d=n(9740),s=n(184);const u=e=>{let{node:t,texture:n,tasselsTexture:o,tassels:l,hex:d}=e;const[u,c]=(0,i.useState)(),v=(0,i.useRef)(null),p=(0,i.useRef)(null),[m,f]=(0,i.useState)(!1),[b,g]=(0,i.useState)(!1),x=(0,i.useMemo)((()=>Object.fromEntries(Object.entries(n).map((e=>{let[t,n]=e;return[t,n.clone()]})))),[n]),{navItems:h,customProduct:M,setSelectedNav:j,texts:w,updateText:y}=(0,a.b)(),S=(0,i.useMemo)((()=>w.find((e=>e.edit))),[w]),P=(0,i.useMemo)((()=>{var e,n;return null===M||void 0===M||null===(e=M.attributes)||void 0===e||null===(n=e.parts)||void 0===n?void 0:n.find((e=>{var n;return null===e||void 0===e||null===(n=e.modelParts)||void 0===n?void 0:n.data.find((e=>{var n,a;return(null===(n=e.attributes)||void 0===n?void 0:n.nodeId)===t.userData.name||(null===(a=e.attributes)||void 0===a?void 0:a.nodeId)===t.name}))}))}),[M,t]),T=(0,i.useMemo)((()=>h.find((e=>e.id===(null===P||void 0===P?void 0:P.id)))),[P,h]),R=(0,i.useMemo)((()=>h.find((e=>"names"===e.type))),[h]);return(0,i.useEffect)((()=>{if(x&&p.current){let e={};for(const[t,n]of Object.entries(x)){n.wrapS=n.wrapT=r.RepeatWrapping;const a=(new r.Box3).setFromObject(p.current),o=new r.Vector3,i=a.getSize(o),l=i.x*i.y;n.repeat.set(5e-4*l,5e-4*l),e={...e,[t]:n}}c(e)}}),[x]),v.current&&(v.current.needsUpdate=!0),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("mesh",{name:t.name,geometry:t.geometry,ref:p,userData:{name:t.userData.name},onPointerDown:e=>{f(!0)},onPointerMove:e=>{m&&g(!0)},onClick:e=>{var n;if(f(!1),g(!1),!m||b)return;if(null!==S&&void 0!==S&&S.key)return;const a=null===(n=e.intersections.find((e=>e.object.userData.text)))||void 0===n?void 0:n.object.userData.text;if(R&&void 0!==R.index&&a&&a.key)return j(R.index),void y(a.key,{edit:!0});T&&void 0!==T.index&&e.intersections[0].object.name===t.name&&(e.stopPropagation(),j(T.index))},children:l?(0,s.jsx)("meshStandardMaterial",{ref:v,...o,transparent:!0,bumpScale:.15,side:r.DoubleSide,metalness:-.5}):(0,s.jsx)("meshStandardMaterial",{side:r.DoubleSide,...u,displacementScale:null!==u&&void 0!==u&&u.displacementMap?-.001:void 0,ref:v})})})},c=e=>{let{node:t,nodeId:n}=e;const o=(0,a.b)((0,i.useCallback)((e=>e.texture(n)),[n])),l=(0,a.b)((0,i.useCallback)((e=>e.optional(n)),[n])),c=!!n.includes("default"),v=(0,d.m)({...o.materials}),p=(0,d.m)({alphaMap:"https://boxxer-api-dev.nyc3.cdn.digitaloceanspaces.com/tassels/tassels-opacity.jpg",bumpMap:"https://boxxer-api-dev.nyc3.cdn.digitaloceanspaces.com/tassels/tassels-bump.jpg",map:o.materials.map},(e=>{const[t,n,a]=e;n.wrapS=n.wrapT=r.RepeatWrapping,n.flipY=!1,n.repeat.set(1.5,1),n.needsUpdate=!0,t.wrapS=t.wrapT=r.RepeatWrapping,t.flipY=!1,t.repeat.set(1.5,1),t.needsUpdate=!0,a.wrapS=t.wrapT=r.RepeatWrapping,a.flipY=!1,a.repeat.set(1.5,1),a.needsUpdate=!0}));return l?null:(0,s.jsx)(u,{node:t,texture:v,tasselsTexture:p,tassels:c,hex:o.hex})},v=e=>{var t,n,a,o,r,d;let{model:u,addNodes:v}=e;const{nodes:p}=(0,l.L)(null===u||void 0===u||null===(t=u.attributes)||void 0===t||null===(n=t.model)||void 0===n||null===(a=n.data)||void 0===a||null===(o=a.attributes)||void 0===o?void 0:o.url);return(0,i.useEffect)((()=>(delete p.Scene,v(p),()=>{v(p,!0)})),[p]),(0,s.jsx)(s.Fragment,{children:null===u||void 0===u||null===(r=u.attributes)||void 0===r||null===(d=r.parts)||void 0===d?void 0:d.data.map((e=>{var t;return(0,s.jsx)(i.Fragment,{children:(null===e||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.nodeId)&&(0,s.jsx)(c,{node:p[e.attributes.nodeId],nodeId:e.attributes.nodeId},e.attributes.nodeId)},e.id)}))})};var p=n(1435);const m=e=>{var t,n,a,o,l,u,c,v,m;let{flag:f,graphic:b,position:g,orientation:x,scale:h=1}=e;const M=null!==f&&void 0!==f&&null!==(t=f.flag)&&void 0!==t&&null!==(n=t.attributes)&&void 0!==n&&null!==(a=n.image.data)&&void 0!==a&&null!==(o=a.attributes)&&void 0!==o&&o.url?[f.flag.attributes.image.data.attributes.url]:null!==b&&void 0!==b&&null!==(l=b.graphic)&&void 0!==l&&null!==(u=l.attributes)&&void 0!==u&&null!==(c=u.image)&&void 0!==c&&null!==(v=c.data)&&void 0!==v&&null!==(m=v.attributes)&&void 0!==m&&m.url?[b.graphic.attributes.image.data.attributes.url]:[],[j]=(0,d.m)(M),w=(0,i.useMemo)((()=>{var e,t;return(null!==(e=j.source.data.width)&&void 0!==e?e:1)/(null!==(t=j.source.data.height)&&void 0!==t?t:1)}),[j]),y=(0,i.useMemo)((()=>{const e=(new r.Euler).fromArray(x),t=r.MathUtils.radToDeg(e.z),n=(null===f||void 0===f?void 0:f.decalRotation)||(null===b||void 0===b?void 0:b.decalRotation),a=t+(null!==n&&void 0!==n?n:0);return e.z=r.MathUtils.degToRad(a),e}),[null===f||void 0===f?void 0:f.decalRotation,null===b||void 0===b?void 0:b.decalRotation,x]),S=(0,i.useMemo)((()=>new r.Vector3(1*w*h,1*h,4)),[h]);return j?(0,s.jsx)(p._,{position:g,rotation:y,scale:S,children:(0,s.jsx)("meshPhongMaterial",{map:j,transparent:!0,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-20,needsUpdate:!0})}):null},f=e=>{var t,n,a,o,l,d,u,c,v,m;let{text:f={},position:b,orientation:g,scale:x=1}=e;const h=(0,i.useMemo)((()=>{var e;const t=(new r.Euler).fromArray(g),n=r.MathUtils.radToDeg(t.z)+(null!==(e=null===f||void 0===f?void 0:f.decalRotation)&&void 0!==e?e:0);return t.z=r.MathUtils.degToRad(n),t}),[null===f||void 0===f?void 0:f.decalRotation,g]),M=(null!==f&&void 0!==f&&null!==(t=f.material)&&void 0!==t&&null!==(n=t.attributes)&&void 0!==n&&null!==(a=n.images)&&void 0!==a&&a.length&&null!==(o=f.material.attributes.images[0])&&void 0!==o&&null!==(l=o.image.data)&&void 0!==l&&null!==(d=l.attributes)&&void 0!==d&&d.url&&f.material.attributes.images[0].image.data.attributes.url,f.normalMap instanceof r.Texture&&"Luxury"===(null===(u=f.selectedName)||void 0===u||null===(c=u.attributes)||void 0===c?void 0:c.name)?f.normalMap:null),j="2"===(null===(v=f.selectedName)||void 0===v?void 0:v.id),w=!!f.puffPrice,y=!!f.crystalPrice,S="undefined"===typeof f.isVisible||f.isVisible;let P=1;y?P=4:j&&!w?P=.5:j&&w&&(P=3);const T=(0,i.useMemo)((()=>new r.Vector3(3.2*x,.4*x,4)),[x]),R=(0,i.useRef)(null),[k,O]=(0,i.useState)(0);return(0,i.useEffect)((()=>{f.preview&&R.current&&f.preview instanceof r.Texture&&(f.preview.needsUpdate=!0,R.current.needsUpdate=!0)}),[f.preview]),(0,i.useEffect)((()=>{O((e=>e+1))}),[f.normalMap,f.puffPrice,f.crystalPrice,null===(m=f.selectedName)||void 0===m?void 0:m.id]),(0,s.jsx)(p._,{position:b,rotation:h,scale:T,children:(0,s.jsx)("meshStandardMaterial",{ref:R,transparent:!0,roughness:j&&!y?1:0,depthTest:!0,depthWrite:!1,map:f.preview instanceof r.Texture?f.preview:null,normalMap:M,normalScale:new r.Vector2(P,P),opacity:S?1:0})},k)},b=e=>{let{geom:t}=e;const n=(0,a.b)((e=>e.flags)),o=(0,a.b)((e=>e.texts)),i=(0,a.b)((e=>e.graphics));return(0,s.jsxs)("mesh",{geometry:t,renderOrder:1,children:[(0,s.jsx)("meshStandardMaterial",{transparent:!0,colorWrite:!1}),n.map((e=>{if(e.decalPosition&&e.decalOrientation)return(0,s.jsx)(m,{flag:e,position:e.decalPosition,orientation:e.decalOrientation,scale:e.decalScale},e.key)})),i.map((e=>{if(e.decalPosition&&e.decalOrientation)return(0,s.jsx)(m,{graphic:e,position:e.decalPosition,orientation:e.decalOrientation,scale:e.decalScale},e.key)})),o.map((e=>{if(e.decalPosition&&e.decalOrientation)return(0,s.jsx)(f,{text:e,position:e.decalPosition,orientation:e.decalOrientation,scale:e.decalScale},e.key)}))]})};var g=n(7133);const x=e=>{let{children:t}=e;const[n,o]=(0,i.useState)(),{customProduct:r}=(0,a.b)();return t({addNodes:function(e,t){if(t){const t={...n};for(const n in e)delete t[n];o({...t})}else o((t=>({...t,...e})))},geom:(0,i.useMemo)((()=>{const e=[];if(n)for(const[o,i]of Object.entries(n)){var t,a;const n=(null!==(t=null===r||void 0===r||null===(a=r.attributes)||void 0===a?void 0:a.parts)&&void 0!==t?t:[]).filter((e=>null===e||void 0===e?void 0:e.optional)).map((e=>{var t;return null===e||void 0===e||null===(t=e.modelParts)||void 0===t?void 0:t.data})).flat().find((e=>{var t;return(null===e||void 0===e||null===(t=e.attributes)||void 0===t?void 0:t.nodeId)===o}));i.isMesh&&!n&&e.push(i.geometry.clone())}return e.length?g.qf(e):null}),[n])})},h=e=>e.selectedModels,M=(0,i.forwardRef)(((e,t)=>{let{onPointerDown:n,onPointerUp:l,onPointerMove:d,onClick:u}=e;const c=(0,a.b)(h),{remountTrigger:p}=(0,a.b)(),m=(0,o.H)((e=>e.modelRotation)),f=(0,o.H)((e=>e.addingToCart));return(0,i.useEffect)((()=>{f&&"function"!==typeof t&&null!==t&&void 0!==t&&t.current&&t.current.rotateY(r.MathUtils.degToRad(m))}),[f,m]),(0,s.jsx)("group",{name:"meshGroup",ref:t,onPointerDown:n,onPointerUp:l,onPointerMove:d,onClick:u,dispose:null,children:(0,s.jsx)(x,{children:e=>{let{addNodes:t,geom:n}=e;return(0,s.jsxs)(s.Fragment,{children:[c.map((e=>{var n;return(0,s.jsx)(v,{model:e.model,addNodes:t},null===(n=e.model)||void 0===n?void 0:n.id)})),n&&(0,s.jsx)(b,{geom:n})]})}},p)})}));M.displayName="Scene";const j=M}}]);
//# sourceMappingURL=369.ce276ed4.chunk.js.map